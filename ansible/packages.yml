---
- name: Install and Uninstall packages.
  hosts: localhost
  connection: local
  gather_facts: yes
  vars:
    apt_wanted:
        - net-tools
        - lm-sensors
        - cryptsetup
        - curl
        - ufw
        - pass
        - pass-extension-otp
        - moreutils
        - htop
        - wofi
        - papirus-icon-theme
        - libnotify-bin
        - qbittorrent
        - mullvad-vpn
        - signal-desktop
        - zbar-tools
        - build-essential
    apt_unwanted:
        - thunderbird
        - rhythmbox
        - shotwell
        - snapd

  tasks:
    - name: Fail on non-Debian
      fail:
        msg: "This playook is meant for Debian-based systems"
      when: ansible_os_family != "Debian"

    - name: Add the 'mullvad' repository
      become: yes
      ansible.builtin.deb822_repository:
        name: Mullvad VPN stable
        types: deb
        uris: https://repository.mullvad.net/deb/stable
        suites: stable
        components:
          - main
        architectures: amd64
        signed_by: https://repository.mullvad.net/deb/mullvad-keyring.asc
        enabled: true
        state: present

    - name: Add the 'signal' repository
      become: yes
      ansible.builtin.deb822_repository:
        name: Signal stable
        types: deb
        uris: https://updates.signal.org/desktop/apt
        suites: xenial
        components:
          - main
        architectures: amd64
        signed_by: https://updates.signal.org/desktop/apt/keys.asc
        enabled: true
        state: present

    - name: Update APT cache
      apt:
        update_cache: yes
      become: yes

    - name: Remove unwanted packages
      apt:
        name: "{{ apt_unwanted }}"
        state: absent
        purge: yes
      become: yes
      ignore_errors: yes

    - name: Install wanted packages
      apt:
        name: "{{ apt_wanted }}"
        state: present
      become: yes

    - name: Autoremove unused packages
      apt:
        autoremove: yes
      become: yes
